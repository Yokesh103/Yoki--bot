pipeline {
    agent any

    stages {

        stage('Checkout') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/Yokesh103/Yoki--bot.git'
            }
        }

        stage('Build Docker Images') {
            steps {
                sh 'echo "Docker build disabled â€“ Jenkins container cannot run Docker directly."'
            }
        }

       stage('Run Tests') {
    steps {
        sh '''
            echo "=== Smoke Test: OptionChain ==="
            curl -sf "http://localhost:8000/optionchain?symbol=BANKNIFTY" || exit 1

            echo "=== Smoke Test: Greeks ==="
            curl -sf -X POST "http://localhost:8001/compute" \
                -H "Content-Type: application/json" \
                -d '{"ltp":400,"strike":59000,"ttm_days":3,"option_type":"CE","underlying":59039}' || exit 1

            echo "=== Smoke Test: Signal ==="
            curl -sf "http://localhost:8002/signal?symbol=BANKNIFTY" || exit 1

            echo "=== Smoke Test: OrderManager ==="
            curl -sf -X POST "http://localhost:8003/submit" \
                -H "Content-Type: application/json" \
                -d '{"symbol":"BANKNIFTY","qty":25}' || exit 1

            echo "=== Smoke Test: PaperExec ==="
            curl -sf -X POST "http://localhost:8004/exec" \
                -H "Content-Type: application/json" \
                -d '{"order_id":"smoke-test"}' || exit 1

            echo "=== ALL SMOKE TESTS PASSED ==="
        '''
    }
}


        stage('Push to Registry') {
            when {
                expression { return false }   // disabled intentionally
            }
            steps {
                sh 'echo "Push image to registry"'
            }
        }
    }
}
